apiVersion: networking.istio.io/v1beta1
kind: ServiceEntry
metadata:
  name: external-example-com
  namespace: microservices
  labels:
    app.kubernetes.io/name: external-example-com
    app.kubernetes.io/component: networking
    app.kubernetes.io/managed-by: navigator
spec:
  hosts:
  - example.com
  ports:
  - number: 80
    name: http
    protocol: HTTP
  location: MESH_EXTERNAL
  resolution: DNS
  endpoints:
  - address: istio-ingressgateway.istio-system.svc.cluster.local
    ports:
      http: 80  # HTTP port for ingress gateway
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: external-example-com
  namespace: microservices
  labels:
    app.kubernetes.io/name: external-example-com-vs
    app.kubernetes.io/component: networking
    app.kubernetes.io/managed-by: navigator
spec:
  hosts:
  - example.com
  http:
  - route:
    - destination:
        host: istio-ingressgateway.istio-system.svc.cluster.local
        port:
          number: 80
    timeout: 30s
    retries:
      attempts: 3
      perTryTimeout: 10s
---
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: external-example-com
  namespace: microservices
  labels:
    app.kubernetes.io/name: external-example-com-dr
    app.kubernetes.io/component: networking
    app.kubernetes.io/managed-by: navigator
spec:
  host: example.com
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 10
      http:
        http1MaxPendingRequests: 10
        maxRequestsPerConnection: 2